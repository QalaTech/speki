/**
 * MDXEditor Dark Theme Overrides
 * Matches the application's dark color scheme
 */

/* ===== Error Banner ===== */
.spec-editor-error-banner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  background: rgba(210, 153, 34, 0.15);
  border: 1px solid #d29922;
  border-radius: 8px 8px 0 0;
  color: #d29922;
  font-size: 13px;
  margin-bottom: -1px;
}

.spec-editor-error-banner button {
  padding: 4px 12px;
  background: transparent;
  border: 1px solid #d29922;
  border-radius: 4px;
  color: #d29922;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.spec-editor-error-banner button:hover {
  background: rgba(210, 153, 34, 0.2);
}

/* ===== Main Editor Container ===== */
.mdxeditor {
  --accentBase: #58a6ff;
  --accentBgSubtle: rgba(88, 166, 255, 0.1);
  --accentBg: rgba(88, 166, 255, 0.15);
  --accentBgHover: rgba(88, 166, 255, 0.25);
  --accentText: #58a6ff;
  --accentTextContrast: #ffffff;
  --accentSolid: #58a6ff;
  --accentSolidHover: #79b8ff;

  --baseBase: #30363d;
  --baseBgSubtle: #161b22;
  --baseBg: #0d1117;
  --baseBgHover: #21262d;
  --baseBorder: #30363d;
  --baseBorderHover: #484f58;
  --baseBorderFocus: #58a6ff;
  --baseText: #c9d1d9;
  --baseTextContrast: #ffffff;
  --baseTextHighContrast: #f0f6fc;
  --baseTextMuted: #8b949e;

  /* Bridge editor variables to theme */
  --color-bg: lch(10 1 272);
  --color-text: oklch(98% 0.005 260);
  --color-text-muted: oklch(65% 0.01 260);
  --color-border: lch(20 1 272);
  --color-surface: lch(16 1.5 272);
  --color-surface-hover: lch(20 1.5 272);
  --color-accent: oklch(58% 0.233 277);

  background: var(--color-bg) !important;
  color: var(--color-text) !important;
  border: none !important;
  border-radius: 8px;
}

/* ===== Content Editable Area ===== */
.mdxeditor .mdxeditor-root-contenteditable,
.mdxeditor .mdxeditor-root-contenteditable.ProseMirror {
  background: var(--color-bg) !important;
  color: var(--color-text) !important;
  caret-color: var(--color-text);
  padding: 16px 24px;
  min-height: 300px;
}

.mdxeditor .mdxeditor-root-contenteditable:focus,
.mdxeditor .mdxeditor-root-contenteditable.ProseMirror:focus {
  outline: none;
}

/* Placeholder text */
.mdxeditor .mdxeditor-root-contenteditable p.is-editor-empty:first-child::before,
.mdxeditor [class*="_placeholder_"] {
  color: var(--color-text-muted) !important;
}

/* ===== Toolbar ===== */
.mdxeditor [class*="_toolbar_"],
.mdxeditor [class*="_toolbarRoot_"] {
  background: var(--color-surface) !important;
  border-bottom: 1px solid var(--color-border) !important;
  padding: 8px 12px;
}

/* Toolbar buttons */
.mdxeditor [class*="_toolbarButton_"],
.mdxeditor [class*="_iconButton_"],
.mdxeditor button[class*="_toolbar"] {
  background: transparent !important;
  color: var(--color-text-muted) !important;
  border: none !important;
  border-radius: 4px;
  padding: 6px 8px;
  transition: all 0.15s ease;
}

.mdxeditor [class*="_toolbarButton_"]:hover,
.mdxeditor [class*="_iconButton_"]:hover,
.mdxeditor button[class*="_toolbar"]:hover {
  background: var(--color-surface-hover) !important;
  color: var(--color-text) !important;
}

.mdxeditor [class*="_toolbarButton_"][data-state="on"],
.mdxeditor [class*="_toolbarButton_"].active,
.mdxeditor [class*="_iconButton_"][data-state="on"],
.mdxeditor [class*="_toolbarToggleItem_"][data-state="on"],
.mdxeditor [class*="_toolbarToggleItem_"][aria-pressed="true"],
.mdxeditor button[class*="_toolbar"][data-state="on"],
.mdxeditor button[class*="_toolbar"][aria-pressed="true"] {
  background: var(--color-accent) !important;
  color: white !important;
}

/* Toolbar separator */
.mdxeditor [class*="_toolbarSeparator_"],
.mdxeditor [class*="_separator_"] {
  background: var(--color-border) !important;
}

/* Toolbar group titles */
.mdxeditor [class*="_toolbarGroupLabel_"] {
  color: var(--color-text-muted) !important;
  font-size: 11px;
  text-transform: uppercase;
}

/* ===== Dropdowns & Select Menus ===== */
.mdxeditor [class*="_selectTrigger_"],
.mdxeditor [class*="_select_"],
.mdxeditor select {
  background: var(--color-surface) !important;
  color: var(--color-text) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 6px;
  padding: 6px 12px;
}

.mdxeditor [class*="_selectTrigger_"]:hover,
.mdxeditor [class*="_select_"]:hover {
  border-color: var(--color-border) !important;
  background: var(--color-surface-hover) !important;
}

/* Dropdown content */
.mdxeditor [class*="_selectContent_"],
.mdxeditor [class*="_popoverContent_"],
.mdxeditor [class*="_dropdownContent_"],
.mdxeditor [role="listbox"],
.mdxeditor [role="menu"] {
  background: var(--color-surface) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 8px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
  overflow: hidden;
}

/* MDXEditor select menus are portaled and can otherwise sit under sticky app chrome */
.mdxeditor-popup-container,
.mdxeditor [class*="_popupContainer_"] {
  z-index: 1200 !important;
}

.mdxeditor-select-content,
.mdxeditor [class*="_toolbarNodeKindSelectContainer_"],
.mdxeditor [class*="_toolbarButtonDropdownContainer_"],
.mdxeditor [class*="_toolbarCodeBlockLanguageSelectContent_"],
.mdxeditor [class*="_selectContainer_"] {
  z-index: 1200 !important;
}

[data-radix-popper-content-wrapper]:has(> .mdxeditor-select-content) {
  z-index: 1200 !important;
}

/* Ensure long language lists are scrollable */
.mdxeditor-select-content {
  max-height: min(70vh, 420px) !important;
}

.mdxeditor-select-content [data-editor-dropdown],
.mdxeditor-select-content [data-radix-select-viewport] {
  max-height: min(70vh, 420px) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  overscroll-behavior: contain;
}

/* Dropdown items */
.mdxeditor [class*="_selectItem_"],
.mdxeditor [class*="_menuItem_"],
.mdxeditor [role="option"],
.mdxeditor [role="menuitem"] {
  background: transparent !important;
  color: var(--color-text) !important;
  padding: 8px 12px;
  cursor: pointer;
  transition: background 0.15s ease;
}

.mdxeditor [class*="_selectItem_"]:hover,
.mdxeditor [class*="_menuItem_"]:hover,
.mdxeditor [role="option"]:hover,
.mdxeditor [role="menuitem"]:hover,
.mdxeditor [class*="_selectItem_"][data-highlighted],
.mdxeditor [class*="_menuItem_"][data-highlighted] {
  background: var(--color-surface-hover) !important;
}

.mdxeditor [class*="_selectItem_"][data-state="checked"],
.mdxeditor [role="option"][aria-selected="true"] {
  background: rgba(88, 166, 255, 0.15) !important;
  color: var(--color-accent) !important;
}

/* ===== Dialogs & Modals ===== */
.mdxeditor [class*="_dialogContent_"],
.mdxeditor [class*="_modalContent_"],
.mdxeditor [role="dialog"] {
  background: var(--color-surface) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 12px;
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
  color: var(--color-text) !important;
}

.mdxeditor [class*="_dialogTitle_"],
.mdxeditor [class*="_modalTitle_"] {
  color: var(--color-text) !important;
  font-weight: 600;
}

.mdxeditor [class*="_dialogOverlay_"],
.mdxeditor [class*="_modalOverlay_"] {
  background: rgba(0, 0, 0, 0.6) !important;
}

/* ===== Input Fields ===== */
.mdxeditor input[type="text"],
.mdxeditor input[type="url"],
.mdxeditor [class*="_textInput_"],
.mdxeditor [class*="_input_"] {
  background: var(--color-bg) !important;
  color: var(--color-text) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 6px;
  padding: 8px 12px;
}

.mdxeditor input[type="text"]:focus,
.mdxeditor input[type="url"]:focus,
.mdxeditor [class*="_textInput_"]:focus,
.mdxeditor [class*="_input_"]:focus {
  border-color: var(--color-accent) !important;
  outline: none;
  box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.2);
}

.mdxeditor input::placeholder {
  color: var(--color-text-muted) !important;
}

/* ===== Action Buttons in Dialogs ===== */
.mdxeditor [class*="_primaryButton_"],
.mdxeditor [class*="_actionButton_"],
.mdxeditor button[type="submit"] {
  background: var(--color-accent) !important;
  color: white !important;
  border: none !important;
  border-radius: 6px;
  padding: 8px 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.15s ease;
}

.mdxeditor [class*="_primaryButton_"]:hover,
.mdxeditor [class*="_actionButton_"]:hover,
.mdxeditor button[type="submit"]:hover {
  background: #79b8ff !important;
}

.mdxeditor [class*="_secondaryButton_"],
.mdxeditor [class*="_cancelButton_"] {
  background: var(--color-surface-hover) !important;
  color: var(--color-text) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 6px;
  padding: 8px 16px;
}

.mdxeditor [class*="_secondaryButton_"]:hover,
.mdxeditor [class*="_cancelButton_"]:hover {
  background: var(--color-border) !important;
}

/* ===== Headings ===== */
.mdxeditor h1,
.mdxeditor h2,
.mdxeditor h3,
.mdxeditor h4,
.mdxeditor h5,
.mdxeditor h6 {
  color: var(--color-text) !important;
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
}

.mdxeditor h1 {
  font-size: 2em;
  color: var(--color-accent) !important;
  border-bottom: 2px solid transparent;
  border-image: linear-gradient(to right, var(--color-accent), transparent) 1;
  padding-bottom: 0.3em;
}

.mdxeditor h2 {
  font-size: 1.5em;
  color: oklch(75% 0.12 256) !important;
  border-bottom: 1px solid var(--color-border);
  padding-bottom: 0.3em;
}

.mdxeditor h3 {
  font-size: 1.25em;
  border-left: 3px solid var(--color-accent);
  padding-left: 12px;
}

.mdxeditor h4 {
  font-size: 1em;
  color: var(--color-text-muted) !important;
}

.mdxeditor h5 {
  font-size: 0.875em;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted) !important;
}

.mdxeditor h6 {
  font-size: 0.85em;
  font-variant: small-caps;
  color: var(--color-text-muted) !important;
}

/* ===== Paragraphs & Text ===== */
.mdxeditor p {
  color: var(--color-text) !important;
  margin: 0 0 16px 0;
  line-height: 1.6;
}

/* ===== Links ===== */
.mdxeditor a {
  color: var(--color-accent) !important;
  text-decoration: none;
}

.mdxeditor a:hover {
  text-decoration: underline;
}

/* ===== Lists ===== */
.mdxeditor ul,
.mdxeditor ol {
  color: var(--color-text) !important;
  padding-left: 2em;
  margin: 0 0 16px 0;
}

.mdxeditor ul {
  list-style: disc outside !important;
}

.mdxeditor ol {
  list-style: decimal outside !important;
}

.mdxeditor ul ul {
  list-style-type: circle !important;
}

.mdxeditor ul ul ul {
  list-style-type: square !important;
}

.mdxeditor ol ol {
  list-style-type: lower-alpha !important;
}

.mdxeditor ol ol ol {
  list-style-type: lower-roman !important;
}

.mdxeditor li {
  color: var(--color-text) !important;
  margin-bottom: 6px;
}

.mdxeditor li::marker {
  color: var(--color-accent);
}

/* Nested lists */
.mdxeditor [class*="_nestedListItem_"] {
  color: var(--color-text) !important;
}

/* ===== Blockquotes ===== */
.mdxeditor blockquote {
  color: var(--color-text-muted) !important;
  border-left: 4px solid var(--color-accent);
  background: oklch(from var(--color-accent) l c h / 5%);
  padding: 12px 16px;
  margin: 0 0 16px 0;
  border-radius: 0 6px 6px 0;
  font-style: italic;
}

/* ===== Horizontal Rule ===== */
.mdxeditor hr {
  border: none;
  border-top: 1px solid var(--color-border);
  margin: 24px 0;
}

/* ===== Inline Code ===== */
.mdxeditor code:not(pre code) {
  background: oklch(from var(--color-accent) l c h / 12%) !important;
  color: oklch(80% 0.12 55) !important;
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
}

/* ===== Code Blocks ===== */
.mdxeditor pre,
.mdxeditor [class*="_codeBlock_"] {
  background: oklch(16% 0.01 256) !important;
  border: 1px solid rgba(148, 163, 184, 0.28) !important;
  border-left: 1px solid rgba(148, 163, 184, 0.38) !important;
  border-radius: 8px;
  margin: 16px 0;
  overflow: hidden;
}

/* MDXEditor's actual code block wrapper carries its own default border color */
.mdxeditor [class*="_codeMirrorWrapper_"] {
  border: 1px solid rgba(148, 163, 184, 0.28) !important;
  border-left: 1px solid rgba(148, 163, 184, 0.38) !important;
}

.mdxeditor [class*="_codeMirrorWrapper_"]:focus-within {
  border-color: rgba(148, 163, 184, 0.38) !important;
  box-shadow: none !important;
  outline: none !important;
}

.mdxeditor pre code {
  background: transparent !important;
  color: #e6edf3 !important;
  display: block;
  padding: 16px;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.5;
}

/* Code block header (language selector) */
.mdxeditor [class*="_codeBlockHeader_"],
.mdxeditor [class*="_codeBlockToolbar_"] {
  background: oklch(from var(--color-accent) l c h / 10%) !important;
  border-bottom: 1px solid rgba(148, 163, 184, 0.28) !important;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.mdxeditor [class*="_codeBlockHeader_"] select,
.mdxeditor [class*="_codeBlockLanguage_"] {
  background: var(--color-surface) !important;
  color: var(--color-text) !important;
  border: 1px solid var(--color-border) !important;
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 12px;
}

/* ===== CodeMirror (Syntax Highlighting) ===== */
.mdxeditor .cm-editor {
  background: transparent !important;
  /* Auto-fit to content */
  height: auto !important;
  min-height: unset !important;
  max-height: unset !important;
}

.mdxeditor .cm-scroller {
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace !important;
  /* Auto-fit: remove fixed height */
  overflow: visible !important;
  min-height: unset !important;
}

/* Code block container - auto-fit to content */
.mdxeditor [class*="_codeBlock_"] {
  height: auto !important;
  min-height: unset !important;
}

.mdxeditor .cm-content {
  min-height: unset !important;
  padding: 12px 16px !important;
  color: #e6edf3 !important;
  caret-color: #e6edf3 !important;
}

.mdxeditor .cm-cursor {
  border-left-color: #e6edf3 !important;
}

.mdxeditor .cm-gutters {
  min-height: unset !important;
  background: #161b22 !important;
  border-right: 1px solid var(--color-border) !important;
  color: var(--color-text-muted) !important;
}

.mdxeditor .cm-activeLineGutter {
  background: #21262d !important;
}

.mdxeditor .cm-activeLine {
  background: rgba(110, 118, 129, 0.1) !important;
}

.mdxeditor .cm-selectionBackground,
.mdxeditor .cm-selection {
  background: rgba(88, 166, 255, 0.2) !important;
}

.mdxeditor .cm-selectionLayer .cm-selectionBackground {
  background: rgba(88, 166, 255, 0.22) !important;
}

/* Keep matched brace pairs visible in dark mode (avoid white block artifacts) */
.mdxeditor .cm-matchingBracket {
  color: #c9d1d9 !important;
  background: rgba(88, 166, 255, 0.18) !important;
  outline: 1px solid rgba(88, 166, 255, 0.45) !important;
  outline-offset: -1px;
  border-radius: 2px;
}

.mdxeditor .cm-nonmatchingBracket {
  color: #ff7b72 !important;
  background: rgba(248, 81, 73, 0.18) !important;
  outline: 1px solid rgba(248, 81, 73, 0.5) !important;
  outline-offset: -1px;
  border-radius: 2px;
}

/* CodeMirror syntax colors */
.mdxeditor .cm-keyword { color: #ff7b72 !important; }
.mdxeditor .cm-string { color: #a5d6ff !important; }
.mdxeditor .cm-string2 { color: #a5d6ff !important; }
.mdxeditor .cm-number { color: #79c0ff !important; }
.mdxeditor .cm-comment { color: #b8c4ce !important; font-style: italic; }
.mdxeditor .cm-variableName { color: #ffa657 !important; }
.mdxeditor .cm-propertyName { color: #79c0ff !important; }
.mdxeditor .cm-operator { color: #ff7b72 !important; }
.mdxeditor .cm-punctuation { color: #c9d1d9 !important; }
.mdxeditor .cm-bracket { color: #c9d1d9 !important; }
.mdxeditor .cm-tagName { color: #7ee787 !important; }
.mdxeditor .cm-attributeName { color: #79c0ff !important; }
.mdxeditor .cm-attributeValue { color: #a5d6ff !important; }
.mdxeditor .cm-definition { color: #d2a8ff !important; }
.mdxeditor .cm-typeName { color: #ffa657 !important; }
.mdxeditor .cm-atom { color: #79c0ff !important; }
.mdxeditor .cm-bool { color: #79c0ff !important; }

/* ===== Tables ===== */
.mdxeditor table {
  border-collapse: separate;
  width: 100%;
  margin: 12px 0;
  font-size: 0.95rem;
  line-height: 1.45;
}

.mdxeditor [class*="_tableEditor_"] {
  --table-border: rgba(148, 163, 184, 0.38);
  --table-border-soft: rgba(148, 163, 184, 0.28);
  --table-bg: rgba(19, 22, 30, 0.98);
  --table-header-bg: rgba(40, 43, 68, 0.9);
  --table-row-bg: rgba(28, 30, 36, 0.95);
  --table-row-alt-bg: rgba(31, 34, 41, 0.95);
  --table-row-hover-bg: rgba(40, 44, 52, 0.98);
  --table-active-bg: rgba(84, 96, 146, 0.22);
  --table-active-outline: rgba(132, 146, 212, 0.72);
  --baseBgActive: var(--baseBorder);
  --baseLine: var(--baseBorder);
  --baseSolid: #a371f7;

  table-layout: auto !important;
  border-collapse: separate !important;
  border-spacing: 0 !important;
  background: var(--table-bg) !important;
  border: 1px solid var(--table-border-soft) !important;
  border-radius: 10px;
  overflow: visible;
  position: relative;
}

.mdxeditor [class*="_tableEditor_"] > colgroup > col:first-child,
.mdxeditor [class*="_tableEditor_"] > colgroup > col:last-child {
  width: 0 !important;
  min-width: 0 !important;
}

.mdxeditor [class*="_tableEditor_"] > thead > tr > th[data-tool-cell="true"],
.mdxeditor [class*="_tableEditor_"] > thead > tr > th[class*="_tableToolsColumn_"],
.mdxeditor [class*="_tableEditor_"] > tbody > tr > [class*="_toolCell_"],
.mdxeditor [class*="_tableEditor_"] > tbody > tr > [data-tool-cell="true"] {
  width: 0 !important;
  min-width: 0 !important;
  height: 0 !important;
  min-height: 0 !important;
  padding: 0 !important;
  border: none !important;
  background: transparent !important;
  position: relative;
  overflow: visible !important;
}

.mdxeditor [class*="_tableEditor_"] > thead [class*="_iconButton_"] {
  display: none !important;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"],
.mdxeditor [class*="_tableRowEditorTrigger_"] {
  position: absolute !important;
  width: 20px !important;
  height: 20px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(148, 163, 184, 0.45) !important;
  background: rgba(23, 27, 35, 0.92) !important;
  color: rgba(219, 227, 255, 0.9) !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 0 !important;
  line-height: 0 !important;
  opacity: 0 !important;
  pointer-events: none !important;
  z-index: 3;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.28);
  transition: opacity 0.14s ease, transform 0.14s ease, background 0.14s ease, border-color 0.14s ease, color 0.14s ease;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"] {
  top: 5px !important;
  left: 50% !important;
  transform: translate(-50%, -100%) scale(0.9) !important;
}

.mdxeditor [class*="_tableRowEditorTrigger_"] {
  left: 6px !important;
  top: 50% !important;
  transform: translate(0, -50%) scale(0.9) !important;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"][data-active="true"],
.mdxeditor [class*="_tableRowEditorTrigger_"][data-active="true"],
.mdxeditor [class*="_tableColumnEditorTrigger_"][data-state="open"],
.mdxeditor [class*="_tableRowEditorTrigger_"][data-state="open"] {
  opacity: 1 !important;
  pointer-events: auto !important;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"][data-active="true"],
.mdxeditor [class*="_tableColumnEditorTrigger_"][data-state="open"] {
  transform: translate(-50%, -100%) scale(1) !important;
}

.mdxeditor [class*="_tableRowEditorTrigger_"][data-active="true"],
.mdxeditor [class*="_tableRowEditorTrigger_"][data-state="open"] {
  transform: translate(0, -50%) scale(1) !important;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"]:hover,
.mdxeditor [class*="_tableRowEditorTrigger_"]:hover {
  background: rgba(40, 45, 58, 0.98) !important;
  border-color: rgba(168, 182, 246, 0.75) !important;
  color: #f1f5ff !important;
}

.mdxeditor [class*="_tableColumnEditorTrigger_"] svg,
.mdxeditor [class*="_tableRowEditorTrigger_"] svg {
  width: 12px !important;
  height: 12px !important;
  display: block !important;
  margin: 0 !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr > th:not([data-tool-cell="true"]),
.mdxeditor [class*="_tableEditor_"] > tbody > tr > td:not([data-tool-cell="true"]) {
  padding: 0 !important;
  border-right: 1px solid var(--table-border) !important;
  border-bottom: 1px solid var(--table-border) !important;
  vertical-align: top;
  line-height: 1.2 !important;
  color: var(--color-text) !important;
  background: var(--table-row-bg);
  height: auto !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr > th:not([data-tool-cell="true"]) {
  background: var(--table-header-bg) !important;
  color: var(--color-text) !important;
  font-weight: 600;
  letter-spacing: 0.01em;
}

.mdxeditor [class*="_tableEditor_"] [class*="_leftAlignedCell_"] {
  text-align: left !important;
}

.mdxeditor [class*="_tableEditor_"] [class*="_centeredCell_"] {
  text-align: center !important;
}

.mdxeditor [class*="_tableEditor_"] [class*="_rightAlignedCell_"] {
  text-align: right !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr > :last-child {
  border-right: none !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr:last-child > th:not([data-tool-cell="true"]),
.mdxeditor [class*="_tableEditor_"] > tbody > tr:last-child > td:not([data-tool-cell="true"]) {
  border-bottom: none !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr:nth-child(even) > td:not([data-tool-cell="true"]) {
  background: var(--table-row-alt-bg);
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr:hover > td:not([data-tool-cell="true"]) {
  background: var(--table-row-hover-bg);
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr > th[data-active="true"],
.mdxeditor [class*="_tableEditor_"] > tbody > tr > td[data-active="true"] {
  outline: 2px solid var(--table-active-outline) !important;
  outline-offset: -2px !important;
  background: var(--table-active-bg) !important;
}

.mdxeditor table[class*="_tableEditor_"] > tbody > tr > td:not([data-tool-cell="true"]) > div[contenteditable="true"],
.mdxeditor table[class*="_tableEditor_"] > tbody > tr > th:not([data-tool-cell="true"]) > div[contenteditable="true"] {
  margin: 0 !important;
  padding: 5px 12px !important;
  line-height: 1.2 !important;
  box-sizing: border-box !important;
  height: auto !important;
}

.mdxeditor table[class*="_tableEditor_"] > tbody > tr > td:not([data-tool-cell="true"]) > div[contenteditable="true"] > p,
.mdxeditor table[class*="_tableEditor_"] > tbody > tr > th:not([data-tool-cell="true"]) > div[contenteditable="true"] > p {
  margin: 0 !important;
  padding: 0 !important;
  line-height: 1.2 !important;
}

.mdxeditor table[class*="_tableEditor_"] > tbody > tr > td:not([data-tool-cell="true"]) > div[contenteditable="true"] :is(p, div, ul, ol),
.mdxeditor table[class*="_tableEditor_"] > tbody > tr > th:not([data-tool-cell="true"]) > div[contenteditable="true"] :is(p, div, ul, ol) {
  margin: 0 !important;
  padding: 0 !important;
}

.mdxeditor [class*="_tableEditor_"] > tbody > tr > th[data-tool-cell="true"][rowspan] {
  position: relative;
  overflow: visible !important;
}

.mdxeditor [class*="_tableEditor_"] > tfoot,
.mdxeditor [class*="_tableEditor_"] > tfoot > tr,
.mdxeditor [class*="_tableEditor_"] > tfoot > tr > th {
  height: 0 !important;
  padding: 0 !important;
  border: none !important;
  background: transparent !important;
  line-height: 0 !important;
  font-size: 0 !important;
}

.mdxeditor [class*="_tableEditor_"] > tfoot > tr > th:first-child,
.mdxeditor [class*="_tableEditor_"] > tfoot > tr > th:last-child {
  display: none !important;
}

.mdxeditor [class*="_tableEditor_"] > tfoot > tr > th[colspan] {
  position: static !important;
}

.mdxeditor [class*="_addRowButton_"],
.mdxeditor [class*="_addColumnButton_"] {
  position: absolute !important;
  width: 30px !important;
  height: 30px !important;
  border-radius: 999px !important;
  border: 1px solid rgba(132, 146, 212, 0.62) !important;
  background: rgba(32, 36, 52, 0.96) !important;
  color: #dbe3ff !important;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.38);
  opacity: 0 !important;
  transform: scale(0.9);
  pointer-events: none !important;
  z-index: 2;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 0 !important;
  line-height: 0 !important;
  transition: opacity 0.14s ease, transform 0.14s ease, color 0.14s ease, border-color 0.14s ease, background 0.14s ease;
}

.mdxeditor [class*="_addRowButton_"] {
  left: 50% !important;
  bottom: -28px !important;
  transform: translateX(-50%) scale(0.9) !important;
}

.mdxeditor [class*="_addColumnButton_"] {
  right: -14px !important;
  top: 50% !important;
  transform: translateY(-50%) scale(0.9) !important;
}

.mdxeditor [class*="_tableEditor_"]:hover [class*="_addRowButton_"],
.mdxeditor [class*="_tableEditor_"]:hover [class*="_addColumnButton_"],
.mdxeditor [class*="_tableEditor_"]:focus-within [class*="_addRowButton_"],
.mdxeditor [class*="_tableEditor_"]:focus-within [class*="_addColumnButton_"] {
  opacity: 1 !important;
  pointer-events: auto !important;
}

.mdxeditor [class*="_tableEditor_"]:hover [class*="_addRowButton_"],
.mdxeditor [class*="_tableEditor_"]:focus-within [class*="_addRowButton_"] {
  transform: translateX(-50%) scale(1) !important;
}

.mdxeditor [class*="_tableEditor_"]:hover [class*="_addColumnButton_"],
.mdxeditor [class*="_tableEditor_"]:focus-within [class*="_addColumnButton_"] {
  transform: translateY(-50%) scale(1) !important;
}

.mdxeditor [class*="_tableEditor_"] [class*="_addRowButton_"]:hover,
.mdxeditor [class*="_tableEditor_"] [class*="_addColumnButton_"]:hover {
  background: rgba(46, 52, 74, 0.98) !important;
  color: #f1f5ff !important;
  border-color: rgba(168, 182, 246, 0.92) !important;
}

.mdxeditor [class*="_tableEditor_"] [class*="_addRowButton_"] svg,
.mdxeditor [class*="_tableEditor_"] [class*="_addColumnButton_"] svg {
  width: 16px !important;
  height: 16px !important;
  margin: 0 !important;
  display: block !important;
  flex: none !important;
}

.mdxeditor [class*="_addRowButton_"] > *,
.mdxeditor [class*="_addColumnButton_"] > * {
  width: 100%;
  height: 100%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.mdxeditor table th,
.mdxeditor table td {
  border-color: var(--table-border, var(--color-border)) !important;
}

/* ===== Tooltips ===== */
.mdxeditor [class*="_tooltip_"],
.mdxeditor [role="tooltip"] {
  background: var(--color-surface) !important;
  color: var(--color-text) !important;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* ===== Diff View ===== */
.mdxeditor [class*="_diffViewer_"],
.mdxeditor [class*="_sourceEditor_"] {
  background: var(--color-bg) !important;
  color: var(--color-text) !important;
}

/* Diff additions */
.mdxeditor [class*="_diffAdded_"],
.mdxeditor .diff-added {
  background: rgba(35, 134, 54, 0.15) !important;
  color: #7ee787 !important;
}

/* Diff deletions */
.mdxeditor [class*="_diffRemoved_"],
.mdxeditor .diff-removed {
  background: rgba(218, 54, 51, 0.15) !important;
  color: #f85149 !important;
}

/* ===== View Mode Toggle ===== */
.mdxeditor [class*="_viewModeToggle_"],
.mdxeditor [class*="_viewMode_"] {
  background: var(--color-surface) !important;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}

.mdxeditor [class*="_viewModeButton_"] {
  background: transparent !important;
  color: var(--color-text-muted) !important;
  border: none;
  padding: 6px 12px;
}

.mdxeditor [class*="_viewModeButton_"]:hover {
  background: var(--color-surface-hover) !important;
}

.mdxeditor [class*="_viewModeButton_"][data-active="true"],
.mdxeditor [class*="_viewModeButton_"].active {
  background: var(--color-accent) !important;
  color: white !important;
}

/* ===== Selection highlighting ===== */
.mdxeditor ::selection {
  background: rgba(88, 166, 255, 0.3);
}

/* ===== Read-only state ===== */
.mdxeditor.spec-editor--readonly [class*="_contentEditable_"],
.mdxeditor.spec-editor--readonly .ProseMirror {
  cursor: default;
}

/* Hide toolbar in read-only mode */
.spec-editor--readonly .mdxeditor [class*="_toolbar_"],
.spec-editor--readonly .mdxeditor [class*="_toolbarRoot_"] {
  display: none;
}

/* Hide code block controls (dropdown and delete button) in read-only mode */
/* Hide code block headers and toolbars completely */
.spec-editor--readonly .mdxeditor [class*="_codeBlockHeader_"],
.spec-editor--readonly .mdxeditor [class*="_codeBlockToolbar_"],
.spec-editor--readonly .mdxeditor [class*="CodeBlockToolbar"],
.spec-editor--readonly .mdxeditor [class*="CodeBlock"][class*="Toolbar"],
.spec-editor--readonly .mdxeditor [class*="codeBlock"][class*="Toolbar"],
.spec-editor--readonly .mdxeditor [class*="codeBlock"][class*="Header"],
.spec-editor--readonly .mdxeditor div[class*="code"] > div:first-child:has(select),
.spec-editor--readonly .mdxeditor div[class*="code"] > div:first-child:has(button) {
  display: none !important;
  max-height: 0 !important;
  overflow: hidden !important;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
}

/* Hide individual controls as fallback */
.spec-editor--readonly .mdxeditor [class*="_codeBlockHeader_"] select,
.spec-editor--readonly .mdxeditor [class*="_codeBlockHeader_"] button,
.spec-editor--readonly .mdxeditor [class*="_codeBlockToolbar_"] select,
.spec-editor--readonly .mdxeditor [class*="_codeBlockToolbar_"] button,
.spec-editor--readonly .mdxeditor [class*="_codeBlockLanguage_"],
.spec-editor--readonly .mdxeditor div[class*="code"] select,
.spec-editor--readonly .mdxeditor div[class*="code"] button:not(.cm-button) {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* ===== Focus States ===== */
.mdxeditor:focus-within {
  border-color: transparent !important;
  box-shadow: none !important;
}

/* ===== Scrollbar Styling ===== */
.mdxeditor ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.mdxeditor ::-webkit-scrollbar-track {
  background: var(--color-bg);
}

.mdxeditor ::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: 4px;
}

.mdxeditor ::-webkit-scrollbar-thumb:hover {
  background: #484f58;
}

/* ===== Mermaid Editor ===== */
.mermaid-editor-block {
  background: oklch(16% 0.01 256);
  border: 1px solid var(--color-border);
  border-left: 3px solid #a371f7;
  border-radius: 8px;
  margin: 16px 0;
  overflow: hidden;
}

.mermaid-editor-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 12px;
  background: rgba(163, 113, 247, 0.1);
  border-bottom: 1px solid var(--color-border);
}

.mermaid-editor-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.mermaid-zoom-controls {
  display: flex;
  align-items: center;
  gap: 2px;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  overflow: hidden;
}

.mermaid-zoom-btn {
  background: transparent;
  border: none;
  color: var(--color-text-muted);
  font-size: 12px;
  padding: 2px 8px;
  cursor: pointer;
  transition: all 0.15s ease;
  line-height: 1;
}

.mermaid-zoom-btn:hover {
  background: var(--color-surface-hover);
  color: var(--color-text);
}

.mermaid-editor-hint {
  font-size: 11px;
  color: var(--color-text-muted);
  opacity: 0.5;
}

.mermaid-zoom-level {
  font-variant-numeric: tabular-nums;
  min-width: 40px;
  text-align: center;
  border-left: 1px solid var(--color-border);
  border-right: 1px solid var(--color-border);
}

.mermaid-editor-label {
  font-size: 12px;
  font-weight: 600;
  color: #a371f7;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.mermaid-editor-toggle {
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  color: var(--color-text-muted);
  font-size: 12px;
  padding: 2px 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mermaid-editor-toggle:hover {
  background: var(--color-surface-hover);
  color: var(--color-text);
}

.mermaid-editor-textarea {
  display: block;
  width: 100%;
  box-sizing: border-box;
  background: oklch(14% 0.005 256);
  color: #e6edf3;
  border: none;
  border-bottom: 1px solid var(--color-border);
  padding: 12px 16px;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  line-height: 1.5;
  min-height: 160px;
  resize: vertical;
  outline: none;
}

.mermaid-editor-textarea:focus {
  background: oklch(15% 0.005 256);
}

.mermaid-editor-preview {
  padding: 16px;
  display: flex;
  justify-content: center;
  min-height: 60px;
  overflow: auto;
}

/* Mermaid renderer states (shared by editor and chat) */
.mermaid-renderer {
  width: 100%;
  display: flex;
  justify-content: center;
}

.mermaid-renderer svg {
  min-width: 0;
  flex-shrink: 0;
  overflow: visible;
  max-width: none !important;
}

/* Fix mermaid issue #790: foreignObject dimensions are too small for text */
.mermaid-renderer foreignObject {
  overflow: visible !important;
}

.mermaid-renderer .label foreignObject {
  overflow: visible !important;
}

.mermaid-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
}

.mermaid-loading-text {
  color: var(--color-text-muted, #8b949e);
  font-size: 13px;
  font-style: italic;
}

.mermaid-error {
  padding: 12px 16px;
  background: rgba(248, 81, 73, 0.1);
  border: 1px solid rgba(248, 81, 73, 0.3);
  border-radius: 6px;
}

.mermaid-error-label {
  display: block;
  color: #f85149;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 6px;
}

.mermaid-error-message {
  color: #f85149;
  font-size: 12px;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  margin: 0;
  white-space: pre-wrap;
  word-break: break-word;
}

/* Hide mermaid edit controls in read-only mode (keep zoom controls) */
.spec-editor--readonly .mermaid-editor-toggle,
.spec-editor--readonly .mermaid-editor-textarea {
  display: none !important;
}

.spec-editor--readonly .mermaid-editor-block {
  border-left-width: 1px;
}

/* ===== Frontmatter ===== */
.mdxeditor [class*="_frontmatter_"],
.mdxeditor [class*="_frontMatter_"] {
  background: oklch(18% 0.01 256) !important;
  border: 1px solid var(--color-border);
  border-left: 3px solid var(--color-text-muted);
  border-radius: 6px;
  margin: 0 0 24px 0;
  padding: 16px;
  font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
  font-size: 13px;
  color: var(--color-text-muted) !important;
}
