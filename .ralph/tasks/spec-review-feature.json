{
  "projectName": "Spec Review Feature",
  "branchName": "ralph/feature",
  "language": "nodejs",
  "standardsFile": ".ralph/standards/nodejs.md",
  "description": "A feature to validate PRD/spec documents against quality standards, detect 'god specs' that need splitting, and provide interactive review with AI-assisted improvements via CLI and dashboard UI",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define SpecReview TypeScript types",
      "description": "Create TypeScript interfaces for spec review results, verdicts, suggestions, session files, and related data structures. These types are needed by all other spec review components to ensure type safety across the feature.",
      "acceptanceCriteria": [
        "SpecReviewResult interface defined with verdict, categories, suggestions, splitProposal, codebaseContext",
        "SpecReviewCategory interface defined with verdict and issues array",
        "FocusedPromptResult interface defined for individual prompt outputs",
        "GodSpecIndicators interface defined with size, scope, and cohesion indicators",
        "SplitProposal and ProposedSpec interfaces defined for split recommendations",
        "CodebaseContext interface defined for codebase exploration results",
        "SuggestionCard interface defined with id, category, severity, section, lines, textSnippet, issue, suggestedFix, status",
        "ChangeHistoryEntry interface defined for revert functionality",
        "SessionFile interface defined with all fields from PRD FR-21",
        "ChatMessage interface defined for agent conversation",
        "All types exported from src/types/index.ts",
        "Build succeeds with no warnings"
      ],
      "testCases": [],
      "priority": 1,
      "passes": false,
      "notes": "Type definitions only - no logic to test",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {
          "patterns": "Use discriminated unions for verdict types, use branded types for IDs"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-002",
      "title": "Create timeout configuration utility",
      "description": "Implement a utility function to determine the review timeout based on CLI flag, environment variable, or default value. This ensures consistent timeout handling across the spec review feature with proper validation of min/max bounds.",
      "acceptanceCriteria": [
        "getReviewTimeout function accepts optional CLI timeout parameter",
        "CLI flag takes highest priority when provided",
        "RALPH_REVIEW_TIMEOUT_MS environment variable used when no CLI flag",
        "Default of 600000ms (10 minutes) used when neither is set",
        "validateTimeout function enforces minimum of 30000ms (30 seconds)",
        "validateTimeout function enforces maximum of 1800000ms (30 minutes)",
        "Warning logged when timeout is adjusted to bounds",
        "Function is exported and usable by review runner",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "getReviewTimeout_WithCliFlag_ShouldReturnCliValue",
        "getReviewTimeout_WithEnvVar_ShouldReturnEnvValue",
        "getReviewTimeout_WithBoth_ShouldPreferCliFlag",
        "getReviewTimeout_WithNeither_ShouldReturnDefault",
        "validateTimeout_BelowMinimum_ShouldReturnMinimum",
        "validateTimeout_AboveMaximum_ShouldReturnMaximum",
        "validateTimeout_WithinBounds_ShouldReturnSameValue"
      ],
      "priority": 2,
      "passes": false,
      "notes": "",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {
          "examples": "See Technical Notes section in PRD for implementation reference"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-003",
      "title": "Update default CLI from Codex to Claude in settings",
      "description": "Change the default reviewer CLI setting from 'codex' to 'claude' in the settings module. Claude is more widely available and capable, making it a better default for most users.",
      "acceptanceCriteria": [
        "DEFAULT_SETTINGS.reviewer.cli changed from 'codex' to 'claude'",
        "Existing config files with explicit 'codex' setting still work",
        "Users without config get Claude as default",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "getSettings_WithNoConfig_ShouldReturnClaudeAsDefault",
        "getSettings_WithExplicitCodex_ShouldReturnCodex",
        "getSettings_WithExplicitClaude_ShouldReturnClaude"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-004",
      "title": "Create focused prompt definitions for standalone spec review",
      "description": "Define the 5 focused prompts for standalone spec review: god spec detection, requirements completeness, clarity/specificity, testability, and scope validation. Each prompt has a single responsibility for improved reliability.",
      "acceptanceCriteria": [
        "GOD_SPEC_DETECTION_PROMPT defined with instructions to explore codebase first",
        "REQUIREMENTS_COMPLETENESS_PROMPT defined with golden standard rules placeholder",
        "CLARITY_SPECIFICITY_PROMPT defined with vagueness detection rules",
        "TESTABILITY_PROMPT defined with verification criteria",
        "SCOPE_VALIDATION_PROMPT defined with scope creep detection",
        "All prompts output structured JSON with verdict and issues",
        "All prompts include clear RULES section",
        "Prompts exported from src/core/spec-review/prompts.ts",
        "Build succeeds with no warnings"
      ],
      "testCases": [],
      "priority": 4,
      "passes": false,
      "notes": "Prompt template definitions only - testing happens in integration",
      "dependencies": [
        "US-001"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "examples": "See PRD Technical Notes for GOD_SPEC_DETECTION_PROMPT example"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-005",
      "title": "Create focused prompt definitions for decompose review",
      "description": "Define the 4 focused prompts for decompose/task review: missing requirements, contradictions, dependency validation, and duplicate detection. These prompts compare spec documents against generated tasks without tool access.",
      "acceptanceCriteria": [
        "MISSING_REQUIREMENTS_PROMPT defined to check spec coverage",
        "CONTRADICTIONS_PROMPT defined to detect task/spec conflicts",
        "DEPENDENCY_VALIDATION_PROMPT defined to check task references",
        "DUPLICATE_DETECTION_PROMPT defined to find redundant tasks",
        "All prompts include placeholders for specContent and tasksJson",
        "All prompts output structured JSON with verdict and findings",
        "Prompts exported from src/core/spec-review/prompts.ts",
        "Build succeeds with no warnings"
      ],
      "testCases": [],
      "priority": 5,
      "passes": false,
      "notes": "Prompt template definitions only - testing happens in integration",
      "dependencies": [
        "US-001"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "examples": "See PRD Technical Notes for detailed prompt examples"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-006",
      "title": "Implement codebase context gatherer",
      "description": "Create a module that gathers codebase context for the review agent, including project structure, technology stack, and existing patterns. This context helps the agent provide meaningful validation against actual architecture.",
      "acceptanceCriteria": [
        "gatherCodebaseContext function explores project directory structure",
        "Function identifies project type from package.json, config files",
        "Function identifies existing patterns (REST API, database, etc.)",
        "Function identifies relevant files/directories that spec may affect",
        "Returns CodebaseContext object with projectType, existingPatterns, relevantFiles",
        "Works with TypeScript/Node.js projects",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "gatherCodebaseContext_WithPackageJson_ShouldIdentifyNodeProject",
        "gatherCodebaseContext_WithTsConfig_ShouldIdentifyTypeScript",
        "gatherCodebaseContext_WithSrcDirectory_ShouldIncludeInStructure",
        "gatherCodebaseContext_WithNoProjectFiles_ShouldReturnUnknownType"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "patterns": "Use glob patterns to find relevant files, parse package.json for dependencies"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-007",
      "title": "Implement god spec detector",
      "description": "Create logic to analyze spec documents for god spec indicators including size metrics, scope analysis, and cohesion assessment. When indicators are found, generate a split proposal with proper file naming.",
      "acceptanceCriteria": [
        "detectGodSpec function analyzes spec content for indicators",
        "Size indicators detected: >3 major sections, >15 estimated stories, >2000 words",
        "Scope indicators detected: multiple user journeys, >3 system boundaries",
        "Cohesion indicators detected: no single definition of done, weak dependencies",
        "Returns GodSpecIndicators with isGodSpec boolean and indicator list",
        "If isGodSpec, generates SplitProposal with proposed specs",
        "Split file naming follows {basename}.{feature}.md pattern",
        "Feature names are kebab-case, 1-3 words",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "detectGodSpec_WithSmallSpec_ShouldReturnNotGodSpec",
        "detectGodSpec_WithManyFeatures_ShouldReturnGodSpec",
        "detectGodSpec_WithHighWordCount_ShouldAddSizeIndicator",
        "detectGodSpec_WithMultipleBoundaries_ShouldAddScopeIndicator",
        "generateSplitProposal_ShouldCreateKebabCaseFilenames",
        "generateSplitProposal_ShouldEstimateStoriesPerSplit"
      ],
      "priority": 7,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {
          "patterns": "Use regex to count sections, word count utilities, section header analysis"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-008",
      "title": "Implement spec splitter",
      "description": "Create functionality to execute spec splits by creating new spec files from a split proposal. Preserves the original spec and creates self-contained child specs with proper naming and cross-references.",
      "acceptanceCriteria": [
        "executeSplit function takes SplitProposal and creates new files",
        "New files named according to {basename}.{feature}.md pattern",
        "Each new spec includes 'Split from: {original}' header",
        "Original spec is NOT deleted or modified",
        "Function returns list of created file paths",
        "Files are placed in same directory as original spec",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "executeSplit_ShouldCreateAllProposedFiles",
        "executeSplit_ShouldNotModifyOriginalSpec",
        "executeSplit_ShouldIncludeSplitFromHeader",
        "executeSplit_ShouldPlaceFilesInSameDirectory",
        "executeSplit_ShouldReturnCreatedPaths"
      ],
      "priority": 8,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001",
        "US-007"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-009",
      "title": "Implement result aggregator for spec review",
      "description": "Create logic to combine results from multiple focused prompts into a single SpecReviewResult with an overall verdict. Handles priority (SPLIT_RECOMMENDED > FAIL > NEEDS_IMPROVEMENT > PASS) and categorizes issues.",
      "acceptanceCriteria": [
        "aggregateResults function takes array of FocusedPromptResult",
        "Returns single SpecReviewResult with overall verdict",
        "SPLIT_RECOMMENDED takes highest priority when god spec detected",
        "FAIL if any prompt returned critical failure",
        "NEEDS_IMPROVEMENT if non-critical issues found",
        "PASS only if all prompts passed",
        "Issues are categorized by prompt type",
        "Suggestions are prioritized by severity",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "aggregateResults_AllPass_ShouldReturnPass",
        "aggregateResults_OneFail_ShouldReturnFail",
        "aggregateResults_NeedsImprovement_ShouldReturnNeedsImprovement",
        "aggregateResults_WithGodSpec_ShouldReturnSplitRecommended",
        "aggregateResults_ShouldCategorizeIssuesByType",
        "aggregateResults_ShouldPrioritizeSuggestions"
      ],
      "priority": 9,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-010",
      "title": "Implement spec review runner for standalone review",
      "description": "Create the main orchestrator that runs focused prompts sequentially for standalone spec review. Spawns the CLI agent with full tool access, runs all 5 prompts, aggregates results, and handles timeouts.",
      "acceptanceCriteria": [
        "runSpecReview function accepts spec file path and options",
        "Spawns Claude CLI by default (or Codex if configured)",
        "Agent spawned WITH full tool access (not --tools '')",
        "Runs god spec detection prompt first",
        "Runs remaining 4 prompts regardless of god spec result",
        "Uses configurable timeout from US-002",
        "Gracefully terminates on timeout (SIGTERM, then SIGKILL after 5s)",
        "Returns aggregated SpecReviewResult",
        "Logs all prompts and responses to .ralph/logs/",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "runSpecReview_ShouldSpawnAgentWithTools",
        "runSpecReview_ShouldRunGodSpecFirst",
        "runSpecReview_ShouldRunAllPrompts",
        "runSpecReview_ShouldAggregateResults",
        "runSpecReview_OnTimeout_ShouldTerminateGracefully",
        "runSpecReview_OnTimeout_ShouldReturnPartialResults"
      ],
      "priority": 10,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-002",
        "US-004",
        "US-006",
        "US-007",
        "US-009"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {
          "patterns": "Use child_process.spawn for CLI, AbortController for timeout"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-011",
      "title": "Implement spec review runner for decompose integration",
      "description": "Create a runner variant for decompose --review that runs focused prompts WITHOUT tool access. Compares spec documents against generated tasks using the 4 decompose-specific prompts.",
      "acceptanceCriteria": [
        "runDecomposeReview function accepts spec content and tasks JSON",
        "Spawns CLI agent WITHOUT tools (--tools '' for Claude)",
        "Runs 4 focused prompts: missing, contradictions, dependencies, duplicates",
        "Returns aggregated result with PASS or FAIL verdict",
        "On FAIL, returns structured feedback for revision",
        "Respects RALPH_MAX_REVIEW_ATTEMPTS for retry logic",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "runDecomposeReview_ShouldSpawnAgentWithoutTools",
        "runDecomposeReview_ShouldRunAllFourPrompts",
        "runDecomposeReview_OnPass_ShouldReturnPassVerdict",
        "runDecomposeReview_OnFail_ShouldReturnStructuredFeedback"
      ],
      "priority": 11,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-002",
        "US-005",
        "US-009"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-012",
      "title": "Create qala spec parent command",
      "description": "Register a new 'spec' parent command in the CLI that groups spec-related subcommands. This follows the commander.js pattern for subcommand organization.",
      "acceptanceCriteria": [
        "spec command registered in src/cli/index.ts",
        "spec command has description 'Spec document management'",
        "Running 'qala spec' shows available subcommands",
        "Running 'qala spec --help' shows help for spec commands",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "specCommand_WithNoSubcommand_ShouldShowHelp",
        "specCommand_WithHelp_ShouldShowSubcommands"
      ],
      "priority": 12,
      "passes": false,
      "notes": "",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-013",
      "title": "Implement qala spec review CLI command",
      "description": "Create the 'qala spec review' CLI command that validates a spec file against quality standards. Supports file argument or interactive selection, configurable timeout, CLI selection, and JSON output.",
      "acceptanceCriteria": [
        "Command registered as subcommand of 'spec'",
        "qala spec review <file> reviews specified file",
        "qala spec review prompts for file selection when no argument",
        "File picker searches specs/, docs/, .ralph/specs/, current directory",
        "--timeout <ms> flag overrides default timeout",
        "--cli claude|codex flag overrides config setting",
        "--json flag outputs machine-readable JSON",
        "--verbose flag shows detailed progress",
        "Exit code 0 on PASS",
        "Exit code 1 on FAIL/NEEDS_IMPROVEMENT/SPLIT_RECOMMENDED",
        "Exit code 2 on error",
        "Human-readable output by default (per PRD format)",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "specReview_WithFile_ShouldReviewThatFile",
        "specReview_WithoutFile_ShouldPromptForSelection",
        "specReview_WithTimeout_ShouldUseProvidedTimeout",
        "specReview_WithCli_ShouldUseSpecifiedCli",
        "specReview_WithJson_ShouldOutputJson",
        "specReview_OnPass_ShouldExitZero",
        "specReview_OnFail_ShouldExitOne",
        "specReview_OnError_ShouldExitTwo"
      ],
      "priority": 13,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-010",
        "US-012"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "patterns": "Use inquirer for interactive file selection"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-014",
      "title": "Implement interactive god spec split flow in CLI",
      "description": "When a god spec is detected, present the user with Accept/Modify/Skip options in the CLI. Handle each choice appropriately: create files on Accept, allow editing on Modify, continue with warning on Skip.",
      "acceptanceCriteria": [
        "SPLIT_RECOMMENDED verdict triggers interactive prompt",
        "User sees warning with detected indicators and proposed splits",
        "Accept option creates all split files via splitter",
        "Modify option allows user to edit proposed split before creating",
        "Skip option continues review with 'not recommended' warning",
        "After Accept, shows list of created files and next steps",
        "Original spec preserved in all cases",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "godSpecFlow_OnAccept_ShouldCreateSplitFiles",
        "godSpecFlow_OnModify_ShouldAllowEditing",
        "godSpecFlow_OnSkip_ShouldContinueWithWarning",
        "godSpecFlow_ShouldPreserveOriginalSpec"
      ],
      "priority": 14,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-008",
        "US-013"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "patterns": "Use inquirer for interactive prompts"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-015",
      "title": "Implement review logging",
      "description": "Create logging functionality that saves all review attempts, prompts, and responses to .ralph/logs/ for debugging and audit purposes.",
      "acceptanceCriteria": [
        "Review creates .ralph/logs/spec_review_<timestamp>.log (human-readable)",
        "Review creates .ralph/logs/spec_review_<timestamp>.prompts/ directory",
        "Each prompt's input/output saved as separate file in prompts directory",
        "Review creates .ralph/logs/spec_review_<timestamp>.json (machine-readable)",
        "Logs include codebase exploration results",
        "Timestamp format is ISO 8601 (e.g., 2026-01-10T10-30-00)",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "reviewLogging_ShouldCreateLogFile",
        "reviewLogging_ShouldCreatePromptsDirectory",
        "reviewLogging_ShouldSaveEachPromptSeparately",
        "reviewLogging_ShouldCreateJsonOutput"
      ],
      "priority": 15,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-010"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-016",
      "title": "Integrate --review flag with qala decompose",
      "description": "Modify the existing qala decompose command to accept a --review flag that triggers automatic peer review of generated tasks using the new focused prompts runner.",
      "acceptanceCriteria": [
        "--review flag added to decompose command",
        "When flag present, triggers runDecomposeReview after decomposition",
        "Uses same timeout and CLI settings as standalone review",
        "On FAIL, attempts automatic revision up to RALPH_MAX_REVIEW_ATTEMPTS times",
        "On PASS, saves final output",
        "Existing decompose behavior unchanged without flag",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "decompose_WithReview_ShouldTriggerPeerReview",
        "decompose_WithReview_OnFail_ShouldRetryRevision",
        "decompose_WithoutReview_ShouldSkipPeerReview"
      ],
      "priority": 16,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-011"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-017",
      "title": "Implement file-based session storage",
      "description": "Create session file management for spec reviews, storing session state in .ralph/sessions/{basename}.session.json. Sessions track suggestions, changes, chat history, and split relationships.",
      "acceptanceCriteria": [
        "loadSession function reads session file for a given spec",
        "saveSession function writes session file with all state",
        "getSessionPath returns .ralph/sessions/{basename}.session.json path",
        "computeContentHash generates SHA256 hash for change detection",
        "Session file schema matches SessionFile interface from US-001",
        "Auto-creates .ralph/sessions/ directory if not exists",
        "Handles missing session files gracefully (returns null)",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "loadSession_WithExistingFile_ShouldReturnSession",
        "loadSession_WithNoFile_ShouldReturnNull",
        "saveSession_ShouldWriteValidJson",
        "getSessionPath_ShouldReturnCorrectPath",
        "computeContentHash_ShouldReturnSha256"
      ],
      "priority": 17,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {
          "patterns": "Use crypto.createHash for SHA256"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-018",
      "title": "Implement change tracker for revert functionality",
      "description": "Create a change tracking module that records all modifications made during a review session, enabling users to revert individual changes. Integrates with session storage.",
      "acceptanceCriteria": [
        "trackChange function records ChangeHistoryEntry",
        "Each entry has id, suggestionId, timestamp, action, section, oldText, newText",
        "canRevert flag set based on whether revert is possible",
        "revertChange function restores previous content",
        "Changes stored in session file's changeHistory array",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "trackChange_ShouldAddToHistory",
        "trackChange_ShouldGenerateUniqueId",
        "revertChange_ShouldRestorePreviousContent",
        "revertChange_WithInvalidId_ShouldThrow"
      ],
      "priority": 18,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001",
        "US-017"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-019",
      "title": "Implement agent feedback handler",
      "description": "Create a module that processes user feedback (approve/reject/edit) on suggestions and updates the agent context for preference learning within a session.",
      "acceptanceCriteria": [
        "handleApproval function processes approved suggestions",
        "handleRejection function processes rejected suggestions with optional reason",
        "handleEdit function processes user-modified suggestions",
        "Agent context string updated to reflect user preferences",
        "Feedback stored in session file for persistence",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "handleApproval_ShouldUpdateSuggestionStatus",
        "handleRejection_ShouldRecordReason",
        "handleEdit_ShouldStoreUserVersion",
        "handleFeedback_ShouldUpdateAgentContext"
      ],
      "priority": 19,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-001",
        "US-017"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-020",
      "title": "Implement dynamic loop limit calculator",
      "description": "Create a utility function that calculates the loop limit for task execution based on task count rather than using a hardcoded value. Formula: ceil((existingTasks + newTasks) * 1.2).",
      "acceptanceCriteria": [
        "calculateLoopLimit function accepts existingTasks and newTasks counts",
        "Returns ceil((existingTasks + newTasks) * 1.2)",
        "Handles edge cases: zero tasks, large task counts",
        "Function exported from src/core/ralph-loop/loop-limit.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "calculateLoopLimit_With10Tasks_ShouldReturn12",
        "calculateLoopLimit_With25Tasks_ShouldReturn30",
        "calculateLoopLimit_With50Tasks_ShouldReturn60",
        "calculateLoopLimit_WithZeroTasks_ShouldReturn0",
        "calculateLoopLimit_ShouldRoundUp"
      ],
      "priority": 20,
      "passes": false,
      "notes": "",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-021",
      "title": "Integrate dynamic loop limit into task executor",
      "description": "Modify the ralph-loop task executor to use the dynamic loop limit calculator instead of a hardcoded default. Recalculate limit when tasks are added mid-execution.",
      "acceptanceCriteria": [
        "Task executor uses calculateLoopLimit for initial limit",
        "Default of 25 no longer used when task count is known",
        "Loop limit recalculated when tasks are added during execution",
        "Recalculation updates limit (not current task index)",
        "All existing tasks fit within calculated window",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "taskExecutor_ShouldUseDynamicLimit",
        "taskExecutor_OnTaskAdded_ShouldRecalculateLimit",
        "taskExecutor_ShouldNotUseHardcodedDefault"
      ],
      "priority": 21,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-020"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-022",
      "title": "Create spec review API routes",
      "description": "Create backend API routes for the dashboard's spec review functionality including file listing, review session management, and feedback handling.",
      "acceptanceCriteria": [
        "GET /api/spec-review/files returns list of markdown files",
        "POST /api/spec-review/start initiates review session, returns sessionId",
        "GET /api/spec-review/status/:sessionId returns review status/results",
        "POST /api/spec-review/feedback accepts approve/reject/edit actions",
        "POST /api/spec-review/chat handles chat messages",
        "POST /api/spec-review/split executes spec split",
        "POST /api/spec-review/split/preview returns preview without saving",
        "POST /api/spec-review/revert reverts a change",
        "GET /api/spec-review/suggestions/:sessionId returns pending suggestions",
        "All routes registered in src/server/routes/spec-review.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "getFiles_ShouldReturnMarkdownFiles",
        "startReview_ShouldReturnSessionId",
        "getStatus_WithValidSession_ShouldReturnResults",
        "postFeedback_ShouldUpdateSession",
        "postChat_ShouldAddToHistory",
        "postSplit_ShouldCreateFiles",
        "postRevert_ShouldRestoreContent"
      ],
      "priority": 22,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-010",
        "US-017",
        "US-018",
        "US-019"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-023",
      "title": "Create session API routes",
      "description": "Create API routes for session file management, allowing the dashboard to load, save, and check existence of session files.",
      "acceptanceCriteria": [
        "GET /api/sessions/spec/:specPath loads session for spec file",
        "PUT /api/sessions/spec/:specPath saves session state",
        "GET /api/sessions/spec/:specPath/exists checks if session exists",
        "Spec path is URL-encoded to handle slashes",
        "Returns 404 when session doesn't exist (for GET)",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "getSession_WithExisting_ShouldReturnSession",
        "getSession_WithNonExisting_ShouldReturn404",
        "putSession_ShouldSaveSession",
        "existsSession_ShouldReturnBoolean"
      ],
      "priority": 23,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-017"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-024",
      "title": "Create MDXEditor configuration module",
      "description": "Create a configuration module for MDXEditor that sets up all required plugins including headings, lists, quotes, code blocks, tables, markdown shortcuts, and diff view support.",
      "acceptanceCriteria": [
        "Configuration exported from web/src/lib/mdx-editor/config.ts",
        "headingsPlugin configured for markdown headings",
        "listsPlugin configured for bullet/numbered lists",
        "quotePlugin configured for blockquotes",
        "codeBlockPlugin configured with syntax highlighting",
        "tablePlugin configured for table editing",
        "markdownShortcutPlugin configured for shortcuts",
        "diffSourcePlugin configured for diff view mode",
        "Configuration reusable across components",
        "Build succeeds with no warnings"
      ],
      "testCases": [],
      "priority": 24,
      "passes": false,
      "notes": "Configuration only - tested through component integration",
      "dependencies": [],
      "complexity": "low",
      "context": {
        "suggestions": {
          "examples": "See MDXEditor docs at https://mdxeditor.dev/"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-025",
      "title": "Create Lexical utility functions for scroll and highlight",
      "description": "Create utility functions that interact with the Lexical editor (underlying MDXEditor) to scroll to sections, highlight text, and find nodes by content.",
      "acceptanceCriteria": [
        "scrollToSection function scrolls editor to heading by text",
        "scrollToLine function scrolls to specific line number",
        "highlightText function temporarily highlights text snippet",
        "Highlight fades after 3 seconds or on user interaction",
        "findNodeByText function locates Lexical node containing text",
        "getSelectedText function returns current selection",
        "All functions exported from web/src/lib/mdx-editor/lexical-utils.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "scrollToSection_WithValidHeading_ShouldScroll",
        "highlightText_ShouldApplyDecoration",
        "highlightText_ShouldFadeAfterTimeout",
        "findNodeByText_WithMatch_ShouldReturnNode",
        "findNodeByText_WithNoMatch_ShouldReturnNull",
        "getSelectedText_WithSelection_ShouldReturnText"
      ],
      "priority": 25,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-024"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {
          "patterns": "Use Lexical's $getNodeByKey(), node.selectStart(), scrollIntoView()"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-026",
      "title": "Create editor command utilities",
      "description": "Create utility functions for programmatic editing operations in MDXEditor including text replacement, insertion at line, and line deletion.",
      "acceptanceCriteria": [
        "replaceText function replaces oldText with newText in document",
        "insertAtLine function inserts text at specific line",
        "deleteLines function removes a range of lines",
        "All operations update the editor state correctly",
        "Functions exported from web/src/lib/mdx-editor/editor-commands.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "replaceText_ShouldReplaceContent",
        "replaceText_WithNoMatch_ShouldNotChange",
        "insertAtLine_ShouldInsertAtPosition",
        "deleteLines_ShouldRemoveRange"
      ],
      "priority": 26,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-024"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-027",
      "title": "Create diff view utilities",
      "description": "Create utility functions for managing the MDXEditor diff view mode, including showing diffs, exiting diff view, and getting user-modified content.",
      "acceptanceCriteria": [
        "showDiff function enters diff mode with original vs proposed",
        "exitDiffView function exits diff mode with optional apply",
        "getProposedContent returns user-edited proposed content",
        "createUnifiedDiff generates unified diff string",
        "Functions exported from web/src/lib/mdx-editor/diff-utils.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "showDiff_ShouldEnterDiffMode",
        "exitDiffView_WithApply_ShouldApplyChanges",
        "exitDiffView_WithoutApply_ShouldDiscard",
        "getProposedContent_ShouldReturnEditedContent",
        "createUnifiedDiff_ShouldGenerateDiff"
      ],
      "priority": 27,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-024"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-028",
      "title": "Create agent feedback client utilities",
      "description": "Create client-side utilities and a React hook for sending feedback to the agent when users approve, reject, or edit suggestions.",
      "acceptanceCriteria": [
        "sendApprovalFeedback sends approval with applied text",
        "sendRejectionFeedback sends rejection with optional reason",
        "sendEditFeedback sends edit with original and user version",
        "useAgentFeedback hook manages feedback state",
        "Hook provides loading state during API calls",
        "Functions exported from web/src/lib/agent-feedback.ts",
        "Hook exported from web/src/hooks/useAgentFeedback.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "sendApprovalFeedback_ShouldCallApi",
        "sendRejectionFeedback_ShouldIncludeReason",
        "sendEditFeedback_ShouldSendBothVersions",
        "useAgentFeedback_ShouldTrackLoadingState"
      ],
      "priority": 28,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-022"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-029",
      "title": "Create useSession React hook",
      "description": "Create a React hook for managing spec review session state, including loading, saving, and tracking changes to the session file.",
      "acceptanceCriteria": [
        "Hook loads session on mount for given spec path",
        "Hook auto-saves after state changes",
        "Hook detects external spec file changes via hash comparison",
        "Hook provides session state and update functions",
        "Hook provides loading and error states",
        "Exported from web/src/hooks/useSession.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "useSession_ShouldLoadExistingSession",
        "useSession_ShouldCreateNewSession",
        "useSession_ShouldAutoSave",
        "useSession_ShouldDetectExternalChanges"
      ],
      "priority": 29,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-023"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-030",
      "title": "Create useSpecReview React hook",
      "description": "Create a React hook for managing the overall spec review state including starting review, handling results, and managing suggestions.",
      "acceptanceCriteria": [
        "Hook provides startReview function to initiate review",
        "Hook tracks review status and progress",
        "Hook provides suggestions array and update functions",
        "Hook handles split proposals",
        "Hook integrates with useSession for persistence",
        "Exported from web/src/hooks/useSpecReview.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "useSpecReview_StartReview_ShouldCallApi",
        "useSpecReview_ShouldTrackStatus",
        "useSpecReview_ShouldUpdateSuggestions",
        "useSpecReview_ShouldHandleSplitProposal"
      ],
      "priority": 30,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-022",
        "US-029"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-031",
      "title": "Create useSpecEditor React hook",
      "description": "Create a React hook for managing MDXEditor state, selection tracking, and programmatic editor access via ref.",
      "acceptanceCriteria": [
        "Hook provides editor ref for programmatic access",
        "Hook tracks current selection",
        "Hook provides setContent function to update editor",
        "Hook triggers onChange when content changes",
        "Hook saves to disk on content change",
        "Exported from web/src/hooks/useSpecEditor.ts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "useSpecEditor_ShouldProvideEditorRef",
        "useSpecEditor_ShouldTrackSelection",
        "useSpecEditor_SetContent_ShouldUpdateEditor",
        "useSpecEditor_OnChange_ShouldSaveToDisk"
      ],
      "priority": 31,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-024",
        "US-025",
        "US-026",
        "US-027"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-032",
      "title": "Create SpecEditor component",
      "description": "Create the main spec editor component wrapping MDXEditor with configured plugins. This is the left panel of the split view showing the spec content.",
      "acceptanceCriteria": [
        "Component renders MDXEditor with spec content",
        "All plugins from US-024 are enabled",
        "Editor ref is accessible via useSpecEditor hook",
        "WYSIWYG editing works for all markdown features",
        "Diff view mode toggle available",
        "Component exported from web/src/components/spec-review/SpecEditor.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SpecEditor_ShouldRenderContent",
        "SpecEditor_ShouldSupportWYSIWYG",
        "SpecEditor_ShouldToggleDiffView"
      ],
      "priority": 32,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-024",
        "US-031"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-033",
      "title": "Create SuggestionCard component",
      "description": "Create a component for displaying individual review suggestions with interactive buttons for Review Diff, Show in Editor, and Dismiss actions.",
      "acceptanceCriteria": [
        "Component displays issue description and location",
        "Component shows severity indicator (critical/warning/info)",
        "Component shows preview of proposed change (truncated)",
        "[Review Diff] button triggers diff view in editor",
        "[Show in Editor] button scrolls to section and highlights",
        "[Dismiss] button marks suggestion as rejected",
        "Approved/rejected/edited state reflected in card appearance",
        "Component exported from web/src/components/spec-review/SuggestionCard.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SuggestionCard_ShouldDisplayIssue",
        "SuggestionCard_ReviewDiff_ShouldTriggerDiffView",
        "SuggestionCard_Show_ShouldScrollAndHighlight",
        "SuggestionCard_Dismiss_ShouldMarkRejected"
      ],
      "priority": 33,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-025",
        "US-027",
        "US-028"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-034",
      "title": "Create GodSpecWarning component",
      "description": "Create a component for displaying the god spec detection warning with Accept Split, Modify, and Skip action buttons.",
      "acceptanceCriteria": [
        "Component displays warning header and icon",
        "Component explains why spec is problematic",
        "Component lists detected indicators",
        "Component shows proposed split specs with estimates",
        "[Accept Split] button initiates split execution",
        "[Modify] button opens split editing dialog",
        "[Skip] button dismisses with warning",
        "Component exported from web/src/components/spec-review/GodSpecWarning.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "GodSpecWarning_ShouldDisplayIndicators",
        "GodSpecWarning_ShouldShowProposedSpecs",
        "GodSpecWarning_AcceptSplit_ShouldCreateFiles",
        "GodSpecWarning_Skip_ShouldDismiss"
      ],
      "priority": 34,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-022"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-035",
      "title": "Create ReviewChat component",
      "description": "Create a chat interface component for conversational follow-up with the review agent. Supports asking questions and requesting custom changes.",
      "acceptanceCriteria": [
        "Component displays chat history",
        "Text input for typing messages",
        "Send button submits message to agent",
        "Messages show role (user/agent) and timestamp",
        "Selected text context included when available",
        "Agent responses can create new suggestion cards",
        "Component exported from web/src/components/spec-review/ReviewChat.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "ReviewChat_ShouldDisplayHistory",
        "ReviewChat_Send_ShouldSubmitMessage",
        "ReviewChat_ShouldIncludeSelectedText",
        "ReviewChat_AgentResponse_ShouldCreateSuggestion"
      ],
      "priority": 35,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-022",
        "US-031"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-036",
      "title": "Create ChangeHistory component",
      "description": "Create a component for displaying the list of applied changes with the ability to revert individual changes.",
      "acceptanceCriteria": [
        "Component displays list of all applied fixes",
        "Each change shows timestamp, description, section affected",
        "[Revert] button on each change restores previous content",
        "[Revert All] button restores original spec",
        "Reverted changes re-enable original suggestion card",
        "Component exported from web/src/components/spec-review/ChangeHistory.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "ChangeHistory_ShouldDisplayChanges",
        "ChangeHistory_Revert_ShouldRestoreContent",
        "ChangeHistory_RevertAll_ShouldRestoreOriginal"
      ],
      "priority": 36,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-018",
        "US-022"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-037",
      "title": "Create ReviewPanel component",
      "description": "Create the right panel component that contains review results, suggestion cards, god spec warning, and chat interface. Groups suggestions by category.",
      "acceptanceCriteria": [
        "Component displays overall verdict",
        "Component renders GodSpecWarning when split recommended",
        "Component groups SuggestionCards by category",
        "Component includes ReviewChat at bottom",
        "Component has 'Changes' tab showing ChangeHistory",
        "Batch navigation: [Previous] [Next] [Approve All] [Reject All]",
        "Component exported from web/src/components/spec-review/ReviewPanel.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "ReviewPanel_ShouldDisplayVerdict",
        "ReviewPanel_ShouldShowGodSpecWarning",
        "ReviewPanel_ShouldGroupSuggestions",
        "ReviewPanel_BatchNav_ShouldNavigate"
      ],
      "priority": 37,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-033",
        "US-034",
        "US-035",
        "US-036"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-038",
      "title": "Create SpecReviewPage with split view layout",
      "description": "Create the main Spec Review page with split view layout: SpecEditor on left, ReviewPanel on right. Includes file selection and review controls.",
      "acceptanceCriteria": [
        "Page displays file selection dropdown",
        "Dropdown shows markdown files from specs/, docs/, .ralph/specs/",
        "Split view layout with resizable panels",
        "Left panel: SpecEditor component",
        "Right panel: ReviewPanel component",
        "'Start Review' button initiates review",
        "Loading states during review",
        "Page accessible from sidebar navigation",
        "Component exported from web/src/pages/SpecReviewPage.tsx",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SpecReviewPage_ShouldShowFileDropdown",
        "SpecReviewPage_ShouldRenderSplitView",
        "SpecReviewPage_StartReview_ShouldInitiateReview",
        "SpecReviewPage_ShouldShowLoadingState"
      ],
      "priority": 38,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-030",
        "US-032",
        "US-037"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {
          "patterns": "Use CSS Grid or Flexbox for split view, react-resizable-panels for resize"
        },
        "requirements": {}
      }
    },
    {
      "id": "US-039",
      "title": "Add Spec Review menu item to dashboard sidebar",
      "description": "Add a new menu item to the dashboard sidebar navigation that links to the Spec Review page.",
      "acceptanceCriteria": [
        "Spec Review menu item added to sidebar",
        "Menu item navigates to /spec-review route",
        "Active state shown when on Spec Review page",
        "Icon appropriate for spec/document review",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "Sidebar_ShouldShowSpecReviewItem",
        "Sidebar_SpecReview_ShouldNavigate"
      ],
      "priority": 39,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-038"
      ],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-040",
      "title": "Implement diff view approval flow",
      "description": "Implement the complete flow for reviewing suggestions via diff view: entering diff mode, showing Approve/Reject/Edit buttons, and handling each action.",
      "acceptanceCriteria": [
        "[Review Diff] switches editor to diff view mode",
        "Diff view shows current vs proposed side-by-side",
        "[Approve] applies newText, exits diff view, highlights change",
        "[Reject] discards change, exits diff view, optionally prompts for reason",
        "[Edit] allows modifying proposed text, then [Apply Edited]",
        "All actions send feedback to agent via useAgentFeedback",
        "Suggestion card updates to reflect action taken",
        "Change logged for revert functionality",
        "File saved to disk after approval",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "DiffApproval_ReviewDiff_ShouldEnterDiffMode",
        "DiffApproval_Approve_ShouldApplyAndSave",
        "DiffApproval_Reject_ShouldDiscardAndNotify",
        "DiffApproval_Edit_ShouldAllowModification",
        "DiffApproval_ShouldSendFeedbackToAgent"
      ],
      "priority": 40,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-027",
        "US-028",
        "US-033"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-041",
      "title": "Implement selection-based chat context",
      "description": "When the user selects text in the editor and types a chat message, include the selection context so the agent can respond to questions about specific text.",
      "acceptanceCriteria": [
        "Selected text captured from editor via useSpecEditor",
        "Selection included in chat message when present",
        "Agent receives context: { selectedText, question }",
        "Agent responds with context-aware feedback",
        "Works with both questions and change requests",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SelectionChat_ShouldCaptureSelection",
        "SelectionChat_ShouldIncludeInMessage",
        "SelectionChat_AgentShouldReceiveContext"
      ],
      "priority": 41,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-031",
        "US-035"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-042",
      "title": "Implement split preview before saving",
      "description": "When user accepts a split proposal, show a preview of all proposed files before actually writing to disk. User can edit content and must click Save All to commit.",
      "acceptanceCriteria": [
        "[Accept] opens preview modal/view showing all proposed files",
        "User can review and edit each file's content",
        "[Save All] button writes all files to disk",
        "[Cancel] button discards preview without writing",
        "Session file updated with split tracking after save",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SplitPreview_Accept_ShouldShowPreview",
        "SplitPreview_ShouldAllowEditing",
        "SplitPreview_SaveAll_ShouldWriteFiles",
        "SplitPreview_Cancel_ShouldDiscard"
      ],
      "priority": 42,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-022",
        "US-034"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-043",
      "title": "Implement external spec change detection",
      "description": "When loading a session, compare the current spec file hash with stored hash to detect external changes. Show warning and allow user to continue or start fresh.",
      "acceptanceCriteria": [
        "On session load, current file hash computed",
        "Hash compared against session.originalContentHash",
        "If different, warning shown: 'Spec modified since last review'",
        "[Continue] option keeps existing session state",
        "[Start Fresh] option resets session for new review",
        "New hash stored after choice is made",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "ExternalChange_ShouldDetectHashMismatch",
        "ExternalChange_ShouldShowWarning",
        "ExternalChange_Continue_ShouldKeepSession",
        "ExternalChange_StartFresh_ShouldResetSession"
      ],
      "priority": 43,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-017",
        "US-029"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-044",
      "title": "Implement split spec navigation",
      "description": "When viewing a parent spec that has been split, show links to child specs. When viewing a child spec, show link back to parent. Enable easy navigation between related specs.",
      "acceptanceCriteria": [
        "Parent spec shows 'This spec was split into N specs' banner",
        "Banner includes links to each child spec",
        "Child spec shows 'Split from: {parent}' link",
        "Clicking links navigates and loads appropriate session",
        "Works in both file selection dropdown and banner",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "SplitNav_Parent_ShouldShowChildLinks",
        "SplitNav_Child_ShouldShowParentLink",
        "SplitNav_Click_ShouldNavigate"
      ],
      "priority": 44,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-017",
        "US-038"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-045",
      "title": "Add CLI error handling for unavailable CLI",
      "description": "Implement proper error handling when the selected CLI (claude or codex) is not installed. Display helpful error message with installation instructions.",
      "acceptanceCriteria": [
        "Check if selected CLI binary exists in PATH before spawning",
        "If Claude not found: 'Claude CLI not found. Install it or use --cli codex'",
        "If Codex not found: 'Codex CLI not found. Install it or use --cli claude'",
        "Include installation instructions link in error message",
        "Exit with code 1",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "cliCheck_ClaudeNotFound_ShouldShowError",
        "cliCheck_CodexNotFound_ShouldShowError",
        "cliCheck_CliFound_ShouldProceed"
      ],
      "priority": 45,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-010"
      ],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-046",
      "title": "Add golden standard file loading",
      "description": "Implement loading of golden standard files from .ralph/standards/ for use in review prompts. Fall back to built-in defaults if files are missing.",
      "acceptanceCriteria": [
        "Load golden_standard_prd_deterministic_decomposable.md if exists",
        "Load prd_writing_rules_absolute_tldr.md if exists",
        "Fall back to built-in default rules if files not found",
        "Show warning when using defaults",
        "Golden standard content injected into review prompts",
        "All relevant tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "goldenStandard_WithFiles_ShouldLoadContent",
        "goldenStandard_WithoutFiles_ShouldUseDefaults",
        "goldenStandard_WithoutFiles_ShouldShowWarning"
      ],
      "priority": 46,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-004"
      ],
      "complexity": "low",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-047",
      "title": "Add integration tests for spec review CLI",
      "description": "Create integration tests that verify the complete spec review CLI flow including file validation, review execution, and output formatting.",
      "acceptanceCriteria": [
        "Test qala spec review specs/sample.md completes successfully",
        "Test god spec triggers split proposal",
        "Test split acceptance creates correctly named files",
        "Test timeout works at boundaries (30s min, 30m max)",
        "Test both --json and human-readable output",
        "Test exit codes match expected values",
        "All tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "integration_specReview_ShouldComplete",
        "integration_godSpec_ShouldProposeSplit",
        "integration_splitAccept_ShouldCreateFiles",
        "integration_timeout_ShouldEnforceBounds",
        "integration_jsonOutput_ShouldBeValid",
        "integration_exitCodes_ShouldBeCorrect"
      ],
      "priority": 47,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-013",
        "US-014",
        "US-015"
      ],
      "complexity": "high",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    },
    {
      "id": "US-048",
      "title": "Add integration tests for decompose --review",
      "description": "Create integration tests that verify the decompose --review integration uses the new focused prompts and handles retries correctly.",
      "acceptanceCriteria": [
        "Test qala decompose specs/sample.md --review uses focused prompts",
        "Test FAIL verdict triggers automatic revision",
        "Test retry respects RALPH_MAX_REVIEW_ATTEMPTS",
        "Test PASS verdict saves final output",
        "All tests pass",
        "Build succeeds with no warnings"
      ],
      "testCases": [
        "integration_decomposeReview_ShouldUseFocusedPrompts",
        "integration_decomposeReview_OnFail_ShouldRetry",
        "integration_decomposeReview_ShouldRespectMaxAttempts",
        "integration_decomposeReview_OnPass_ShouldSave"
      ],
      "priority": 48,
      "passes": false,
      "notes": "",
      "dependencies": [
        "US-016"
      ],
      "complexity": "medium",
      "context": {
        "suggestions": {},
        "requirements": {}
      }
    }
  ]
}